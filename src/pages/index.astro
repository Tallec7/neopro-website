---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Button from '@/components/Button.astro';
import ClubCarousel from '@/components/ClubCarousel.tsx';
import ContactForm from '@/components/ContactForm.tsx';
import { Image } from 'astro:assets';

// ── Images locales ────────────────────────────────────────────────
import heroImg from '@/assets/images/hero-accueil-v2.webp';
import captureEcranImg from '@/assets/images/capture-ecran.webp';
import apercuTelecommandeImg from '@/assets/images/apercu-telecommande.webp';
import nanoBananaImg from '@/assets/images/nano-banana.webp';

// ── Logos clubs (fallback — remplacés par Sanity quand configuré) ─
import logoRacc from '@/assets/images/logo-racc.webp';
import logoNarh from '@/assets/images/logo-narh.webp';
import logoNlf from '@/assets/images/logo-nlf-fond-blanc.webp';
import logoCorsaires from '@/assets/images/logo-corsaires.webp';
import logoRinkHockey from '@/assets/images/logo-rink-hockey.webp';

// ── Sanity (optionnel) ────────────────────────────────────────────
import { sanityClient } from '@/lib/sanity';
import { clubLogosQuery } from '@/lib/queries';

let clubs: { name: string; logoUrl: string }[] = [];

try {
  if (sanityClient) {
    const sanityClubs = await sanityClient.fetch(clubLogosQuery);
    if (sanityClubs?.length) {
      // Ne garder que les clubs ayant une image uploadée dans Sanity
      const withLogos = sanityClubs.filter((c: any) => c.logoUrl);
      if (withLogos.length) {
        clubs = withLogos.map((c: any) => ({
          name: c.name,
          logoUrl: c.logoUrl,
        }));
      }
    }
  }
} catch {
  // Sanity non configuré — on utilise les images locales
}

if (!clubs.length) {
  clubs = [
    { name: 'RACC Handball Nantes', logoUrl: logoRacc.src },
    { name: 'NARH', logoUrl: logoNarh.src },
    { name: 'Nantes Loire Feminin', logoUrl: logoNlf.src },
    { name: 'Corsaires de Nantes', logoUrl: logoCorsaires.src },
    { name: 'Nantes Rink Hockey', logoUrl: logoRinkHockey.src },
  ];
}

// ── SEO ───────────────────────────────────────────────────────────
const title = 'Regie digitale pour clubs de sport amateurs';
const description =
  "Neopro transforme l'ecran de votre club en un media interactif professionnel. Spots partenaires, animations de match, pilotage depuis un smartphone.";
---

<BaseLayout title={title} description={description}>
  <!-- ═══════ Hero ═══════ -->
  <section class="relative h-[500px] md:h-[631px] bg-[#2f3935] overflow-hidden">
    <Image
      src={heroImg}
      alt="Ecran digital Neopro dans un gymnase"
      class="absolute inset-0 w-full h-full object-cover opacity-20"
      loading="eager"
      widths={[768, 1280, 1920]}
      sizes="100vw"
    />
    <div class="relative z-10 flex flex-col items-center justify-center h-full text-center text-white px-5 max-w-[873px] mx-auto gap-8 md:gap-[43px]">
      <h1 class="text-[36px] md:text-[70px] font-black leading-[1]">
        <span class="font-playfair italic font-normal">On fait de </span>votre écran,
        <br />un média <span class="font-playfair italic font-normal">interactif.</span>
      </h1>
      <div class="flex flex-wrap gap-6 md:gap-[43px] justify-center">
        <Button href="/solution" variant="white">
          Découvrez la solution
        </Button>
        <Button href="/devis" variant="green">
          Obtenez un devis
        </Button>
      </div>
    </div>
  </section>

  <!-- ═══════ Bienvenue au club ═══════ -->
  <section class="bg-[#2f3935] py-24 px-5 overflow-hidden">
    <div class="max-w-[1320px] mx-auto flex flex-col items-center gap-[40px] md:gap-[60px]">
      <h2 class="text-[#81e3bc] text-[48px] md:text-[128px] leading-[1] text-center">
        <span class="font-playfair italic font-normal">Bienvenue </span><span class="font-bold">au club.</span>
      </h2>

      <div class="relative rounded-[20px] overflow-hidden w-full aspect-[2116/1184] bg-[#1a1f1c]">
        <Image
          src={captureEcranImg}
          alt="Aperçu de la solution Neopro"
          class="w-full h-full object-cover"
          loading="lazy"
          widths={[768, 1280]}
          sizes="(max-width: 768px) 100vw, 1200px"
        />
      </div>

      <p class="text-white text-[18px] md:text-[30px] text-center max-w-[967px] leading-normal">
        Neopro propose une <strong class="font-black">solution de régie</strong> adaptée aux contraintes des clubs amateurs,
        dans le but de <strong class="font-black">professionnaliser l'expérience spectateur</strong> et de
        <strong class="font-black">créer un nouvel espace publicitaire pour vos partenaires</strong>.
      </p>
    </div>
  </section>

  <!-- ═══════ La régie de votre club sportif ═══════ -->
  <section class="py-24 px-5">
    <div class="max-w-[1200px] mx-auto flex flex-col md:flex-row gap-12 md:gap-[100px] lg:gap-[151px] items-start">
      <div class="w-full md:w-[550px] flex flex-col gap-[40px]">
        <div>
          <h2 class="text-[36px] md:text-[48px] font-bold text-[#101828] leading-normal">
            La régie<br />de votre club sportif
          </h2>
          <p class="text-[#4a5565] text-[18px] leading-[28px] mt-5">
            On transforme l'écran de votre club en un outil professionnel — spots partenaires,
            animations de match — piloté en quelques clics depuis un smartphone,
            par n'importe quel bénévole.
          </p>
        </div>
        <Button href="/solution" variant="black">
          Découvrez la solution
        </Button>
      </div>
      <div class="flex-1">
        <Image
          src={apercuTelecommandeImg}
          alt="Aperçu télécommande Neopro"
          class="w-full rounded-[20px] object-cover"
          loading="lazy"
          widths={[600, 1200]}
          sizes="(max-width: 768px) 100vw, 50vw"
        />
      </div>
    </div>
  </section>

  <!-- ═══════ Les clubs Neopro (carousel) ═══════ -->
  <ClubCarousel clubs={clubs} client:visible />

  <!-- ═══════ Des offres adaptées à vos clubs ═══════ -->
  <section class="py-24 px-5">
    <div class="max-w-[1200px] mx-auto flex flex-col md:flex-row gap-12 md:gap-[90px] items-start">
      <div class="w-full md:w-[550px] flex flex-col gap-[40px]">
        <div>
          <h2 class="text-[36px] md:text-[48px] font-bold text-[#101828] leading-normal">
            Des offres adaptées à vos clubs
          </h2>
          <p class="text-[#4a5565] text-[18px] leading-[28px] mt-5">
            Tout compris, clé en main.
          </p>
        </div>
        <Button href="/offres" variant="black">
          Découvrez les offres
        </Button>
      </div>
      <div class="flex-1 flex gap-5">
        <div class="flex-1 h-[350px] md:h-[491px] rounded-[20px] overflow-hidden">
          <Image
            src={nanoBananaImg}
            alt="Offres Neopro"
            class="w-full h-full object-cover"
            loading="lazy"
            widths={[600, 1200]}
            sizes="(max-width: 768px) 50vw, 25vw"
          />
        </div>
        <div class="flex-1 h-[350px] md:h-[491px] bg-[#d9d9d9] rounded-[20px]"></div>
      </div>
    </div>
  </section>

  <!-- ═══════ Contact ═══════ -->
  <div id="contact">
    <ContactForm client:visible />
  </div>
</BaseLayout>
