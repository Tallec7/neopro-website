---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Hero from '@/components/Hero.astro';
import Button from '@/components/Button.astro';
import SectionHeading from '@/components/SectionHeading.astro';
import ClubCarousel from '@/components/ClubCarousel.tsx';
import ContactForm from '@/components/ContactForm.tsx';
import { Image } from 'astro:assets';

// ── Images locales ────────────────────────────────────────────────
import heroImg from '@/assets/images/hero-accueil-v2.webp';
import captureEcranImg from '@/assets/images/capture-ecran.webp';
import apercuTelecommandeImg from '@/assets/images/apercu-telecommande.webp';
import nanoBananaImg from '@/assets/images/nano-banana.webp';

// ── Logos clubs (fallback — remplacés par Sanity quand configuré) ─
import logoRacc from '@/assets/images/logo-racc.webp';
import logoNarh from '@/assets/images/logo-narh.webp';
import logoNlf from '@/assets/images/logo-nlf-fond-blanc.webp';
import logoCorsaires from '@/assets/images/logo-corsaires.webp';
import logoRinkHockey from '@/assets/images/logo-rink-hockey.webp';

// ── Sanity (optionnel) ────────────────────────────────────────────
import { sanityClient } from '@/lib/sanity';
import { clubLogosQuery } from '@/lib/queries';

let clubs: { name: string; logoUrl: string }[] = [];

try {
  if (sanityClient) {
    const sanityClubs = await sanityClient.fetch(clubLogosQuery);
    if (sanityClubs?.length) {
      // Ne garder que les clubs ayant une image uploadée dans Sanity
      const withLogos = sanityClubs.filter((c: any) => c.logoUrl);
      if (withLogos.length) {
        clubs = withLogos.map((c: any) => ({
          name: c.name,
          logoUrl: c.logoUrl,
        }));
      }
    }
  }
} catch {
  // Sanity non configuré — on utilise les images locales
}

if (!clubs.length) {
  clubs = [
    { name: 'RACC Handball Nantes', logoUrl: logoRacc.src },
    { name: 'NARH', logoUrl: logoNarh.src },
    { name: 'Nantes Loire Feminin', logoUrl: logoNlf.src },
    { name: 'Corsaires de Nantes', logoUrl: logoCorsaires.src },
    { name: 'Nantes Rink Hockey', logoUrl: logoRinkHockey.src },
  ];
}

// ── SEO ───────────────────────────────────────────────────────────
const title = 'Regie digitale pour clubs de sport amateurs';
const description =
  "Neopro transforme l'ecran de votre club en un media interactif professionnel. Spots partenaires, animations de match, pilotage depuis un smartphone.";
---

<BaseLayout title={title} description={description}>
  <!-- Hero -->
  <Hero
    title={`<span class="font-playfair italic">On fait de votre ecran,</span><br/>un media <span class="font-playfair italic text-neo-green">interactif.</span><br/><span class="font-playfair italic">Tel un club pro.</span>`}
    imageSrc={heroImg}
    imageAlt="Ecran digital Neopro dans un gymnase"
    fullHeight
  >
    <div class="flex flex-wrap gap-4 justify-center mt-8">
      <Button href="/solution" variant="outline" class="!border-white !text-white hover:!bg-white/10" arrow>
        Decouvrez la solution
      </Button>
      <Button href="/devis" variant="green" arrow>
        Obtenez un devis
      </Button>
    </div>
  </Hero>

  <!-- Bienvenue au club -->
  <section class="bg-neo-dark-bg py-24 px-5 overflow-hidden">
    <div class="max-w-[1200px] mx-auto">
      <div class="mb-16">
        <h2 class="text-neo-green text-[60px] md:text-[128px] font-bold leading-[1] mb-6">
          <span class="font-playfair italic">Bienvenue </span>au club.
        </h2>
        <p class="text-white/80 mt-6 text-[18px] md:text-[26px] max-w-[700px]">
          Neopro propose une solution de regie digitale adaptee aux contraintes des clubs amateurs,
          dans le but de professionnaliser l'experience spectateur et de creer un nouvel espace publicitaire
          pour vos partenaires.
        </p>
      </div>
      <div class="relative rounded-[20px] overflow-hidden aspect-video bg-[#1a1f1c]">
        <Image
          src={captureEcranImg}
          alt="Apercu de la solution Neopro"
          class="w-full h-full object-cover"
          loading="lazy"
          widths={[768, 1280]}
          sizes="(max-width: 768px) 100vw, 1200px"
        />
      </div>
    </div>
  </section>

  <!-- La regie digitale de votre club -->
  <section class="py-24 px-5">
    <div class="max-w-[1200px] mx-auto flex flex-col md:flex-row gap-12 items-center">
      <div class="flex-1">
        <SectionHeading
          title="La regie digitale de votre"
          italicWord="club"
          centered={false}
        />
        <p class="text-neo-gray text-[18px] leading-[28px] mb-8 max-w-[500px] mt-4">
          On transforme l'ecran de votre club en un outil professionnel — spots partenaires,
          animations de match — pilote en quelques clics depuis un smartphone,
          par n'importe quel benevole.
        </p>
        <Button href="/solution" variant="black" arrow>
          Decouvrez la solution
        </Button>
      </div>
      <div class="flex-1">
        <Image
          src={apercuTelecommandeImg}
          alt="Apercu telecommande Neopro"
          class="w-full rounded-[20px] object-cover"
          loading="lazy"
          widths={[600, 1200]}
          sizes="(max-width: 768px) 100vw, 50vw"
        />
      </div>
    </div>
  </section>

  <!-- Des offres adaptees a vos clubs -->
  <section class="py-24 px-5">
    <div class="max-w-[1200px] mx-auto flex flex-col md:flex-row-reverse gap-12 items-center">
      <div class="flex-1">
        <SectionHeading
          title="Des offres adaptees a vos"
          italicWord="clubs"
          centered={false}
        />
        <p class="text-neo-gray text-[18px] leading-[28px] mb-8 max-w-[500px] mt-4">
          Financable par vos partenaires. Cle en main.
        </p>
        <Button href="/offres" variant="black" arrow>
          Decouvrez les offres
        </Button>
      </div>
      <div class="flex-1">
        <Image
          src={nanoBananaImg}
          alt="Offres Neopro"
          class="w-full rounded-[20px] object-cover"
          loading="lazy"
          widths={[600, 1200]}
          sizes="(max-width: 768px) 100vw, 50vw"
        />
      </div>
    </div>
  </section>

  <!-- Club Carousel -->
  <ClubCarousel clubs={clubs} client:visible />

  <!-- Contact -->
  <div id="contact">
    <ContactForm client:visible />
  </div>
</BaseLayout>
