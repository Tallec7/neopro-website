---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Button from '@/components/Button.astro';
import ClubCarousel from '@/components/ClubCarousel.tsx';
import ContactForm from '@/components/ContactForm.tsx';
import { Image } from 'astro:assets';

// ── Images locales ────────────────────────────────────────────────
import heroImg from '@/assets/images/hero-accueil-v2.webp';
import captureEcranImg from '@/assets/images/capture-ecran.webp';
import apercuTelecommandeImg from '@/assets/images/apercu-telecommande.webp';
import nanoBananaImg from '@/assets/images/nano-banana.webp';

// ── Logos clubs (fallback — remplacés par Sanity quand configuré) ─
import logoRacc from '@/assets/images/logo-racc.webp';
import logoNarh from '@/assets/images/logo-narh.webp';
import logoNlf from '@/assets/images/logo-nlf-fond-blanc.webp';
import logoCorsaires from '@/assets/images/logo-corsaires.webp';
import logoRinkHockey from '@/assets/images/logo-rink-hockey.webp';

// ── Sanity (optionnel) ────────────────────────────────────────────
import { sanityClient } from '@/lib/sanity';
import { clubLogosQuery } from '@/lib/queries';

let clubs: { name: string; logoUrl: string }[] = [];

try {
  if (sanityClient) {
    const sanityClubs = await sanityClient.fetch(clubLogosQuery);
    if (sanityClubs?.length) {
      // Ne garder que les clubs ayant une image uploadée dans Sanity
      const withLogos = sanityClubs.filter((c: any) => c.logoUrl);
      if (withLogos.length) {
        clubs = withLogos.map((c: any) => ({
          name: c.name,
          logoUrl: c.logoUrl,
        }));
      }
    }
  }
} catch {
  // Sanity non configuré — on utilise les images locales
}

if (!clubs.length) {
  clubs = [
    { name: 'RACC Handball Nantes', logoUrl: logoRacc.src },
    { name: 'NARH', logoUrl: logoNarh.src },
    { name: 'Nantes Loire Feminin', logoUrl: logoNlf.src },
    { name: 'Corsaires de Nantes', logoUrl: logoCorsaires.src },
    { name: 'Nantes Rink Hockey', logoUrl: logoRinkHockey.src },
  ];
}

// ── SEO ───────────────────────────────────────────────────────────
const title = 'Régie digitale pour clubs de sport amateurs';
const description =
  "Neopro transforme l'écran de votre club en un média interactif professionnel. Spots partenaires, animations de match, pilotage depuis un smartphone.";
---

<BaseLayout title={title} description={description}>
  <!-- ═══════ Hero ═══════ -->
  <section class="relative h-[500px] md:h-[743px] bg-[#2f3935] overflow-hidden">
    <Image
      src={heroImg}
      alt="Écran digital Neopro dans un gymnase"
      class="absolute inset-0 w-full h-full object-cover"
      loading="eager"
      widths={[768, 1280, 1920]}
      sizes="100vw"
    />
    <div class="absolute inset-0 bg-gradient-to-r from-[#2f3935] to-[80%] to-[rgba(47,57,53,0.3)]"></div>
    <div class="relative z-10 flex flex-col justify-end h-full text-white p-8 md:p-[60px] gap-8 md:gap-[40px]">
      <h1 class="text-[36px] md:text-[70px] leading-[1]">
        <span class="font-playfair italic font-normal">On fait de votre écran,</span>
        <br /><span class="font-black">un média interactif.</span>
        <br /><span class="font-playfair italic font-normal">Tel un club pro.</span>
      </h1>
      <div class="flex flex-wrap gap-6 md:gap-[43px]">
        <Button href="/solution" variant="white" arrow>
          Découvrez la solution
        </Button>
        <Button href="/devis" variant="green">
          Obtenez un devis
        </Button>
      </div>
    </div>
  </section>

  <!-- ═══════ Bienvenue au club ═══════ -->
  <section class="bg-[#2f3935] py-24 px-5 overflow-hidden">
    <div class="max-w-[1320px] mx-auto flex flex-col items-center gap-[40px] md:gap-[60px]">
      <h2 class="text-[#51b28b] text-[48px] md:text-[128px] leading-[1] text-center">
        <span class="font-playfair italic font-normal">Bienvenue </span><span class="font-black">au club.</span>
      </h2>

      <div class="relative rounded-[20px] overflow-hidden w-full aspect-[2116/1184] bg-[#1a1f1c]">
        <Image
          src={captureEcranImg}
          alt="Aperçu de la solution Neopro"
          class="w-full h-full object-cover"
          loading="lazy"
          widths={[768, 1280]}
          sizes="(max-width: 768px) 100vw, 1200px"
        />
      </div>

      <p class="text-white text-[18px] md:text-[26px] text-center max-w-[1060px] leading-normal">
        Neopro propose une solution de régie digitale adaptée aux contraintes des clubs amateurs,
        dans le but de professionnaliser l'expérience spectateur et de
        créer un nouvel espace publicitaire pour vos partenaires.
      </p>
    </div>
  </section>

  <!-- ═══════ La régie digitale de votre club ═══════ -->
  <section class="py-16 md:py-[96px] px-5 md:px-[60px]">
    <div class="max-w-[1320px] mx-auto flex flex-col md:flex-row gap-12 md:gap-[120px] items-center">
      <div class="w-full md:flex-1 flex flex-col gap-[40px]">
        <div>
          <h2 class="text-[36px] md:text-[48px] font-bold text-[#101828] leading-normal">
            La régie digitale de votre club
          </h2>
          <p class="text-[#4a5565] text-[18px] leading-[28px] mt-5">
            On transforme l'écran de votre club en un outil professionnel — spots partenaires,
            animations de match — piloté en quelques clics depuis un smartphone,
            par n'importe quel bénévole.
          </p>
        </div>
        <Button href="/solution" variant="black" arrow>
          Découvrez la solution
        </Button>
      </div>
      <div class="w-full md:w-[550px] md:h-[550px] flex-shrink-0">
        <Image
          src={apercuTelecommandeImg}
          alt="Aperçu télécommande Neopro"
          class="w-full h-full rounded-[20px] object-cover"
          loading="lazy"
          widths={[600, 1200]}
          sizes="(max-width: 768px) 100vw, 550px"
        />
      </div>
    </div>
  </section>

  <!-- ═══════ Des offres adaptées à vos clubs ═══════ -->
  <section class="py-16 md:py-[96px] px-5 md:px-[60px]">
    <div class="max-w-[1320px] mx-auto flex flex-col md:flex-row gap-12 md:gap-[120px] items-center">
      <div class="relative w-full md:w-[550px] md:h-[550px] flex-shrink-0 rounded-[20px] overflow-hidden">
        <Image
          src={nanoBananaImg}
          alt="Offres Neopro"
          class="w-full h-full object-cover"
          loading="lazy"
          widths={[600, 1200]}
          sizes="(max-width: 768px) 100vw, 550px"
        />
        <div class="absolute inset-0 bg-[rgba(47,57,53,0.3)] rounded-[20px]"></div>
      </div>
      <div class="w-full md:flex-1 flex flex-col gap-[40px]">
        <div>
          <h2 class="text-[36px] md:text-[48px] font-bold text-[#101828] leading-normal">
            Des offres adaptées à vos clubs
          </h2>
          <p class="text-[#4a5565] text-[18px] leading-[28px] mt-5">
            Finançable par vos partenaires. Clé en main.
          </p>
        </div>
        <Button href="/offres" variant="black" arrow>
          Découvrez les offres
        </Button>
      </div>
    </div>
  </section>

  <!-- ═══════ Les clubs Neopro (carousel) ═══════ -->
  <ClubCarousel clubs={clubs} client:visible />

  <!-- ═══════ Contact ═══════ -->
  <div id="contact">
    <ContactForm client:visible />
  </div>
</BaseLayout>
