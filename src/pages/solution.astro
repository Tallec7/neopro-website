---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Hero from '@/components/Hero.astro';
import Button from '@/components/Button.astro';
import SectionHeading from '@/components/SectionHeading.astro';
import SportBullet from '@/components/SportBullet.astro';
import ContactForm from '@/components/ContactForm.tsx';
import { Image } from 'astro:assets';

// ── Images locales ────────────────────────────────────────────────
import heroImg from '@/assets/images/hero-solution.webp';
import dscRetouche1 from '@/assets/images/dsc-retouche-1.webp';
import dscRetouche2 from '@/assets/images/dsc-retouche-2.webp';
import apercuTelecommande2 from '@/assets/images/apercu-telecommande-2.webp';

// ── Sanity (optionnel) ────────────────────────────────────────────
import { sanityClient } from '@/lib/sanity';
import {
  solutionPanelsQuery,
  solutionFeaturesQuery,
  colorPanelsQuery,
} from '@/lib/queries';

// ── Données : panneaux sticky ─────────────────────────────────────
interface SolutionPanel {
  title: string;
  description: string;
  imageUrl?: string;
  imageAlt?: string;
}

let solutionPanels: SolutionPanel[] = [];

try {
  if (sanityClient) {
    const data = await sanityClient.fetch(solutionPanelsQuery);
    if (data?.length) solutionPanels = data;
  }
} catch {}

if (!solutionPanels.length) {
  solutionPanels = [
    {
      title: 'Valorisez vos partenaires',
      description:
        "Toute l'année, vos partenaires bénéficieront d'un support de communication pendant vos matchs pour partager leurs actualités. Ils peuvent mettre à jour leurs actualités d'une semaine à l'autre et obtenir des rapports de diffusion.",
    },
    {
      title: 'Célébrez vos joueurs',
      description:
        "Vos joueurs aussi ont le droit de faire comme les pros. Nous proposons de venir filmer leurs célébrations en début d'année, ainsi que tout type de contenu (vidéo/photo) relatif à votre média day.",
    },
    {
      title: 'Partagez vos actualités',
      description:
        "Assurez-vous que vos supporters ne passent pas à côté de vos prochains matchs, les soirées du club et vos produits à vendre sur votre boutique.",
    },
  ];
}

// Images locales pour les panneaux (fallback quand Sanity n'a pas d'image)
const panelImages = [dscRetouche1, dscRetouche2, apercuTelecommande2];

// Couleurs des icônes sport pour chaque panneau coloré
const panelIconVariants = ['pink', 'yellow', 'green', 'blue'] as const;

// ── Données : features ────────────────────────────────────────────
interface Feature {
  title: string;
  description: string;
}

let features: Feature[] = [];

try {
  if (sanityClient) {
    const data = await sanityClient.fetch(solutionFeaturesQuery);
    if (data?.length) features = data;
  }
} catch {}

if (!features.length) {
  features = [
    {
      title: 'Sans connexion internet',
      description: 'Pas besoin de wifi dans votre salle.',
    },
    {
      title: 'Sans fil',
      description:
        'Commandable à distance grâce à votre téléphone qui sert de télécommande.',
    },
    {
      title: "Simple d'utilisation",
      description:
        "Interface ultra simplifiée, utilisable par n'importe quel bénévole les jours de match.",
    },
  ];
}

// ── Données : panneaux colorés ────────────────────────────────────
interface ColorPanel {
  title: string;
  features: string[];
  bgColor: string;
}

let colorPanels: ColorPanel[] = [];

try {
  if (sanityClient) {
    const data = await sanityClient.fetch(colorPanelsQuery);
    if (data?.length) colorPanels = data;
  }
} catch {}

if (!colorPanels.length) {
  colorPanels = [
    {
      title: 'Accompagnement continu',
      features: [
        'Formation initiale complète',
        'Support technique réactif',
        'Conseils pour optimiser vos contenus',
        "Assistance & mise à jour de vidéos d'une semaine à l'autre",
        "Possibilité d'autonomie complète : accès admin avec intégration visuels/vidéos",
      ],
      bgColor: 'bg-[#3d3036]',
    },
    {
      title: 'Solution clé en main',
      features: [
        'Boîtier pré-configuré livré chez vous',
        'Installation en moins de 5 minutes',
        'Application intuitive et simple',
        'Compatible avec tous les écrans HDMI',
      ],
      bgColor: 'bg-[#423e33]',
    },
    {
      title: 'Production vidéo professionnelle',
      features: [
        'Offre de média day complète (photo+vidéo)',
        'Des templates vidéo de qualité Broadcast, personnalisable aux couleurs de votre club',
      ],
      bgColor: 'bg-[#2f3935]',
    },
    {
      title: 'Les retombées pour votre club',
      features: [
        'Image professionnelle et moderne',
        'Support de communication efficace',
        'Supporters mieux informés et engagés',
        'Visibilité quantifiée pour vos partenaires',
        'Meilleure fidélisation des partenaires',
      ],
      bgColor: 'bg-[#334244]',
    },
  ];
}

// ── SEO ───────────────────────────────────────────────────────────
const title = 'La solution de régie digitale';
const description =
  'Découvrez la solution Neopro : régie digitale clé en main pour clubs amateurs. Sans wifi, sans fil, pilotable depuis un smartphone.';
---

<BaseLayout title={title} description={description}>
  <!-- Hero -->
  <Hero
    title={`La régie digitale de votre <span class="font-playfair italic text-neo-green">club</span>`}
    imageSrc={heroImg}
    imageAlt="La solution Neopro en action"
  />

  <!-- Panneaux solution sticky -->
  <section class="py-24 px-5">
    <div class="max-w-[1200px] mx-auto">
      {solutionPanels.map((panel, i) => (
        <div
          class="sticky top-[120px] bg-white rounded-[20px] shadow-lg overflow-hidden mb-8"
          style={`z-index: ${10 + i}`}
        >
          <div class="flex flex-col md:flex-row gap-8 p-8 md:p-12">
            <div class="flex-1 flex flex-col justify-center">
              <h3 class="text-[28px] md:text-[36px] font-bold mb-4">{panel.title}</h3>
              <p class="text-neo-gray text-[16px]">{panel.description}</p>
            </div>
            <div class="flex-1">
              {panel.imageUrl ? (
                <img
                  src={panel.imageUrl}
                  alt={panel.imageAlt || panel.title}
                  class="w-full rounded-[12px] object-cover"
                  loading="lazy"
                />
              ) : panelImages[i] ? (
                <Image
                  src={panelImages[i]}
                  alt={panel.title}
                  class="w-full rounded-[12px] object-cover"
                  loading="lazy"
                  widths={[600, 1200]}
                  sizes="(max-width: 768px) 100vw, 50vw"
                />
              ) : null}
            </div>
          </div>
        </div>
      ))}
    </div>
  </section>

  <!-- 3 colonnes features -->
  <section class="py-24 px-5">
    <div class="max-w-[1200px] mx-auto">
      <SectionHeading
        title="Adapté à vos"
        italicWord="clubs"
      />
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-16">
        {features.map((feature) => (
          <div class="bg-[rgba(217,217,217,0.6)] rounded-[20px] p-8">
            <h3 class="text-[28px] font-bold mb-3">{feature.title}</h3>
            <p class="text-[18px] text-black/80">{feature.description}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Panneaux couleurs sticky -->
  <section class="py-24 px-5">
    <div class="max-w-[1200px] mx-auto">
      <SectionHeading
        title="Plus qu'une solution"
        italicWord="d'affichage"
      />
      <div class="mt-16">
        {colorPanels.map((panel, i) => (
          <div
            class={`sticky top-[120px] ${panel.bgColor} text-white rounded-[20px] px-10 py-[60px] md:px-10 md:py-[60px] mb-8`}
            style={`z-index: ${10 + i}`}
          >
            <h3 class="text-[28px] font-bold mb-[60px]">{panel.title}</h3>
            <ul class="flex flex-col gap-5">
              {panel.features.map((f) => (
                <li class="flex items-center gap-[15px] text-[20px] text-white">
                  <SportBullet variant={panelIconVariants[i] || 'green'} />
                  {f}
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA vers offres -->
  <section class="py-24 px-5">
    <div class="max-w-[1200px] mx-auto">
      <div class="flex flex-col lg:flex-row items-center gap-10 lg:gap-[120px]">
        <div class="flex-1">
          <h2 class="text-[28px] md:text-[36px] lg:text-[48px] font-bold text-neo-dark mb-4">
            Des offres adaptées à vos <span class="font-playfair italic text-neo-green">clubs</span>
          </h2>
          <p class="text-[18px] text-neo-gray mb-8">
            Finançable par vos partenaires. Clé en main.
          </p>
          <Button href="/offres" variant="black" arrow>
            Découvrez les offres
          </Button>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact -->
  <div id="contact">
    <ContactForm client:visible />
  </div>
</BaseLayout>
